setwd("/Users/MaggieDougherty/Documents/GitHub/CPD-Mental-Health/")
# install packages
install.packages('readxl')
install.packages('tidyverse')
install.packages('tidyr')
install.packages('reshape2')
install.packages('xlsx')
install.packages('writexl')
ls()
library(readxl)
raw_trr <- read_excel("Raw Data/Copy of Chicago UoF 2020-2024.xlsx", sheet = "TRR DATA")
View(raw_trr)
mental <- raw_trr[grep("MENTAL ILL./EMOTIONAL DISORDER", raw_trr$SUBJECT_CONDITION_NEW_TRR), ]
rm(mental)
mh <- raw_trr[grep("MENTAL ILL./EMOTIONAL DISORDER", raw_trr$SUBJECT_CONDITION_NEW_TRR), ]
mh1 <- raw_trr[grep("MENTAL HEALTH", raw_trr$`Type Activity New TRR`), ]
View(mh1)
mh2 <- raw_trr[grep("MENTAL ILL./EMOTIONAL DISORDER", raw_trr$SUBJECT_CONDITION_NEW_TRR) | grep("MENTAL HEALTH", raw_trr$`Type Activity New TRR`), ]
mh2 <- raw_trr[grep("MENTAL ILL./EMOTIONAL DISORDER", raw_trr$SUBJECT_CONDITION_NEW_TRR) || grep("MENTAL HEALTH", raw_trr$`Type Activity New TRR`), ]
mh2 <- raw_trr[
grepl("MENTAL ILL./EMOTIONAL DISORDER", raw_trr$SUBJECT_CONDITION_NEW_TRR, ignore.case = TRUE) |
grepl("MENTAL HEALTH", raw_trr$`Type Activity New TRR`, ignore.case = TRUE),
]
rm(mh mh1 mh2)
rm(mh, mh1, mh2)
mh <- raw_trr[
grepl("MENTAL ILL./EMOTIONAL DISORDER", raw_trr$SUBJECT_CONDITION_NEW_TRR, ignore.case = TRUE) |
grepl("MENTAL HEALTH", raw_trr$`Type Activity New TRR`, ignore.case = TRUE),
]
subject_demographics <-subset(mh, select = c(`REPORT NO`, INCIDENTDATETIME, `STREET NO`, DIR, `STREET NAME`, CITY, STATE, `ZIP CODE`, `LOCATION CODE`, BEAT, WARD, COMMUNITY, EVENT_NO,SUBJSEX, SUB_RACE, SUB_BIRTHYEAR, SUB_ZIPCODE, SUBJECT_CONDITION_NEW_TRR, SUBJECT_INJURED, SUBJECT_ALLEGED_INJURY, `Subject Med Treatment New TRR`, `Subject Actions`, SUBJECT_HOSPITALIZED, SUBJECT_ARMED, SUBJECTARMEDWITH, WEAPON_PERCEIVED_AS, SUBJECT_WEAPON_USE, `Subject Weapon`, SUBDRUGRELATED, `Type Activity New TRR`, `ReasonForResponse New TRR`, `ForceMitigationEfforts New TRR`, `ControlTactics New TRR`))
View(subject_demographics)
subject_demographics$INCIDENTDATETIME <- strptime(subject_demographics$INCIDENTDATETIME, format = "%d-%b-%Y %H:%M")
subject_demographics$year <- format(subject_demographics$INCIDENTDATETIME, "%Y")
year_summary <- subject_demographics %>%
group_by(year) %>%
summarise(Count = n()) %>%
arrange(year)
install.packages("dplyr")
library(dplyr)
year_summary <- subject_demographics %>%
group_by(year) %>%
summarise(Count = n()) %>%
arrange(year)
View(year_summary)
rm(subject_demographics, year_summary)
working_data <-subset(mh, select = c(`REPORT NO`, INCIDENTDATETIME, `STREET NO`, DIR, `STREET NAME`, CITY, STATE, `ZIP CODE`, `LOCATION CODE`, BEAT, WARD, COMMUNITY, EVENT_NO,SUBJSEX, SUB_RACE, SUB_BIRTHYEAR, SUB_ZIPCODE, SUBJECT_CONDITION_NEW_TRR, SUBJECT_INJURED, SUBJECT_ALLEGED_INJURY, `Subject Med Treatment New TRR`, `Subject Actions`, SUBJECT_HOSPITALIZED, SUBJECT_ARMED, SUBJECTARMEDWITH, WEAPON_PERCEIVED_AS, SUBJECT_WEAPON_USE, `Subject Weapon`, SUBDRUGRELATED, `Type Activity New TRR`, `ReasonForResponse New TRR`, `ForceMitigationEfforts New TRR`, `ControlTactics New TRR`))
working_data$INCIDENTDATETIME <- strptime(working_data$INCIDENTDATETIME, format = "%d-%b-%Y %H:%M")
working_data$year <- format(working_data$INCIDENTDATETIME, "%Y")
year_summary <- working_data %>%
group_by(year) %>%
summarise(Count = n()) %>%
arrange(year)
View(year_summary)
View(working_data)
subject_demographics <- working_data %>%
group_by(WARD, SUB_RACE) %>%
summarise(Count = n(), .groups = "drop") %>%
arrange(WARD, SUB_RACE)
View(subject_demographics)
library(tidyr)
subj_dem_wide <- subject_demographics %>%
pivot_wider(
names_from = SUB_RACE,
values_from = Count,
values_fill = 0
)
View(subj_dem_wide)
subject_demographics <- working_data %>%
mutate(WARD = as.numeric(WARD)) %>%
group_by(WARD, SUB_RACE) %>%
summarise(Count = n(), .groups = "drop") %>%
arrange(WARD, SUB_RACE)
subj_dem_wide <- subject_demographics %>%
pivot_wider(
names_from = SUB_RACE,
values_from = Count,
values_fill = 0
)
writexl::write_xlsx(subj_dem_wide, 'Processed Data/Subject Demographics_Mental Health Flag_TRRs.xlsx')
# reshape data wide for flourish
subj_dem_wide <- subject_demographics %>%
pivot_wider(
names_from = SUB_RACE,
values_from = Count,
values_fill = 0
)
View(subject_demographics)
View(subj_dem_wide)
